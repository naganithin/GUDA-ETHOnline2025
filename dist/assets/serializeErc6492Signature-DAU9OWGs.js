import{dh as m,bY as f,bA as M,cf as w}from"./index-DdPqfeSd.js";function k(p){const{source:y}=p,c=new Map,a=new m(8192),i=new Map,o=({address:e,chainId:t})=>`${e}.${t}`;return{async consume({address:e,chainId:t,client:n}){const s=o({address:e,chainId:t}),r=this.get({address:e,chainId:t,client:n});this.increment({address:e,chainId:t});const u=await r;return await y.set({address:e,chainId:t},u),a.set(s,u),u},async increment({address:e,chainId:t}){const n=o({address:e,chainId:t}),s=c.get(n)??0;c.set(n,s+1)},async get({address:e,chainId:t,client:n}){const s=o({address:e,chainId:t});let r=i.get(s);return r||(r=(async()=>{try{const l=await y.get({address:e,chainId:t,client:n}),g=a.get(s)??0;return g>0&&l<=g?g+1:(a.delete(s),l)}finally{this.reset({address:e,chainId:t})}})(),i.set(s,r)),(c.get(s)??0)+await r},reset({address:e,chainId:t}){const n=o({address:e,chainId:t});c.delete(n),i.delete(n)}}}const x="0x6492649264926492649264926492649264926492649264926492649264926492";function h(p){const{address:y,data:c,signature:a,to:i="hex"}=p,o=f([M([{type:"address"},{type:"bytes"},{type:"bytes"}],[y,c,a]),x]);return i==="hex"?o:w(o)}export{k as c,h as s};
